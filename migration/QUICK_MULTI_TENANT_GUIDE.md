# üöÄ –ë—ã—Å—Ç—Ä—ã–π –≥–∞–π–¥: Multi-Tenancy (–ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–∞–Ω–∏–π)

## üìã –ß—Ç–æ –ø–æ–ª—É—á–∏—à—å

**–û–¥–Ω–∞ –ë–î**, –Ω–æ –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞.  
–ö–∞–∫ –≤ –Ω–∞—Å—Ç–æ—è—â–∏—Ö SaaS (Salesforce, Shopify).

---

## ‚ö° 3 –ø—Ä–æ—Å—Ç—ã—Ö —à–∞–≥–∞

### 1. –ü—Ä–∏–º–µ–Ω–∏ SQL –º–∏–≥—Ä–∞—Ü–∏—é

```bash
cd backend
psql -U postgres -d classmate_central -f migrations/006_add_multi_tenancy.up.sql
```

‚úÖ –≠—Ç–æ –¥–æ–±–∞–≤–∏—Ç –ø–æ–ª–µ `company_id` –≤–æ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã  
‚úÖ –¢–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤—è–∂—É—Ç—Å—è –∫ "Smart Education"

---

### 2. –ú–∏–≥—Ä–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏

```bash
cd migration

# Windows:
copy .env.company2 .env

# Linux/Mac:
cp .env.company2 .env

# –ó–∞–ø—É—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏—é
node migrate-from-alfacrm.js

# –ü—Ä–∏–≤—è–∂–∏ –¥–∞–Ω–Ω—ã–µ –∫ company_id
node add-company-id-to-migrated-data.js
```

‚úÖ –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ø–∞–¥—É—Ç –≤ —Ç—É –∂–µ –ë–î —Å `company_id = company-2`

---

### 3. –û–±–Ω–æ–≤–∏—Ç—å backend (TODO)

–ù—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ `company_id` –≤–æ –≤—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã.

**–ü—Ä–∏–º–µ—Ä:**
```go
// –ë—ã–ª–æ:
query := `SELECT * FROM students ORDER BY name`

// –°—Ç–∞–ª–æ:
query := `SELECT * FROM students WHERE company_id = $1 ORDER BY name`
```

–û–±–Ω–æ–≤–∏—Ç—å –Ω—É–∂–Ω–æ –≤—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
- `student_repository.go`
- `teacher_repository.go`
- `group_repository.go`
- `lesson_repository.go`
- –∏ —Ç.–¥.

---

## üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–æ–º–ø–∞–Ω–∏—è–º–∏

### –î–ª—è —Ç–≤–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ (Smart Education):
```bash
cd migration
copy .env .env.backup        # –°–æ—Ö—Ä–∞–Ω–∏ —Ç–µ–∫—É—â–∏–π
copy .env.old .env          # –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞—Ä—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

# –í .env –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
COMPANY_ID=default-company
COMPANY_NAME=Smart Education
```

### –î–ª—è –Ω–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏:
```bash
cd migration
copy .env.company2 .env

# –í .env –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
COMPANY_ID=company-2
COMPANY_NAME=Second Company
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ö–æ–º–ø–∞–Ω–∏—è 1 (—Ç–≤–æ—è)
SELECT COUNT(*) FROM students WHERE company_id = 'default-company';

-- –ö–æ–º–ø–∞–Ω–∏—è 2 (–Ω–æ–≤–∞—è)
SELECT COUNT(*) FROM students WHERE company_id = 'company-2';

-- –í—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏
SELECT company_id, COUNT(*) FROM students GROUP BY company_id;
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- ‚úÖ –ë–î –≥–æ—Ç–æ–≤–∞ –∫ multi-tenancy (–ø–æ—Å–ª–µ Step 1)
- ‚úÖ –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `company_id`
- ‚è≥ **Backend –ù–ï —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç** –ø–æ `company_id` (–Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å)

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ–π—á–∞—Å:
- –î–∞–Ω–Ω—ã–µ —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π **—Ö—Ä–∞–Ω—è—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ** (–ø–æ `company_id`)
- –ù–æ backend **–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï** –¥–∞–Ω–Ω—ã–µ (–Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç)

### –ß—Ç–æ–±—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∞ –ø–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è:
–ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å backend - –¥–æ–±–∞–≤–∏—Ç—å `WHERE company_id = $1` –≤–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã.

---

## üéØ –ò—Ç–æ–≥–æ

### –ü–æ—Å–ª–µ —à–∞–≥–æ–≤ 1-2:
- ‚úÖ –î–≤–µ –∫–æ–º–ø–∞–Ω–∏–∏ –≤ –æ–¥–Ω–æ–π –ë–î
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã
- ‚ö†Ô∏è Backend –ø–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ

### –ü–æ—Å–ª–µ —à–∞–≥–∞ 3 (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ backend):
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è
- ‚úÖ –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –∫–æ–º–ø–∞–Ω–∏—é
- ‚úÖ –ì–æ—Ç–æ–≤–æ–µ SaaS —Ä–µ—à–µ–Ω–∏–µ

---

**–ù–∞—á–Ω–∏ —Å –®–∞–≥–∞ 1!** –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ `MULTI_TENANCY_SETUP.md`

